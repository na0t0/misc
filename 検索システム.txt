検索システム
実務者のための開発改善ガイドブック

第一部のまとめ

用語
全文検索・・・構造化されていないテキストから、特定のキーワードに合致する箇所をすべて見つけ出すこと
フレーズ検索・・・ドキュメントの中で複数のタームが隣り合った、または近接する位置に出現するパターンを検索すること
ドキュメント・・・本の各ページのイメージ
ターム・・・転置インデックスを検索するときの最小単位
ポスティングリスト・・・それぞれのタームが出現するドキュメントの識別子（ドキュメントID）を格納するリスト
転置インデックス・・・本の索引のイメージ。単語が出現するページが書かれている。

無償で利用可能な検索エンジン
Apache Lucene
Vespa
Groonga

タームをどのように選ぶか？・・・「テキスト解析」と呼ばれる
英語での主なテキスト解析
    大文字小文字の処理
    複数形、三人称単数、現在進行形などによる語尾の違いの処理（「ステミング」）
    記号の扱い（I'll、use-case、C#など）
日本語での主なテキスト解析
    全角半角処理
ヨーロッパ系言語でのテキスト解析
    ドイツ語やオランダ語では、複数の名詞が空白なしで接続される場合がある（複合語、合成語）
その他のテキスト解析処理
    Unicode正規化（「が」を、１つのコードで表すか、「か」「゛」の合成文字として表すか、など）
    ストップワード（英語では「a」「the」など。これらをタームとして扱うと転置インデックスのポスティングリストが長くなるためテキスト解析では出力しないこと）
    類義語の展開（quickとfast、Internet ProtocolとIP、など）

転置インデックスの検索では、一般にAND検索のほうがOR検索よりも高速。一因として、AND検索ではすべてのタームを含むドキュメントの身を走査すればよいのでOR検索よりも訪れるポスティングリストが短くて済む。

検索エンジンへのデータ登録の原則
    不要なものは登録しない。
        検索結果として十分な品質がないデータ
        何年間も非アクティブなユーザーによるデータ
        検索結果に一定期間表示されなかったデータ

ETL：一般に、データを入手してから検索エンジンに登録してユーザーが検索できるようになるまでの流れ
    データを入手 Extract
    入手したデータを検索エンジンに合わせて加工（Transform）
    加工したデータを検索エンジンに登録（Load）

検索エンジンのデータを更新するタイミング
    手動更新・・・趣味の検索サービスなど
    バッチ更新・・・図書館検索、求人検索など
    リアルタイム・・・SNS、フリーマーケットアプリなど

ファイルシステムからのデータ収集
    ディレクトリを探索して検索システム向けにファイルを収集するツール
        Elasticsearchへの登録が可能なfscrawler(OSS)
Webからのデータ収集
    PythonのScrapyのようなクローラー
DBからのデータ収集


検索システムのインターフェース設計
    有益なフィードバックを提供する
        オートコンプリート
        クエリ提案
        インクリメンタルサーチ
        検索結果に含まれる、入力ワードと関連性の高い箇所のハイライト
    ユーザーの制御と自動的な制御のバランスをとる
        おすすめの検索クエリの提示
    エラーを減らす（＝検索結果がゼロになること減らす）
        ゼロになるということは、ユーザーと検索システムのインタラクションが途絶えるということ
            →サービスの観点では、このタイミングでユーザーが離脱する可能性が生じる
            →回避するには、検索エンジンやクエリの改善だけでなく、オートコンプリートで入力間違いを防ぐなど検索インターフェースの工夫も有効
    短期記憶の負荷を軽減する
    ショートカットを提示する
    細部の重要性を理解する
    美的意識の重要性を理解する
        （後ろ４つは、検索システムに特化した設計ガイドライン[Hea09]による）

「テキストボックスのみの検索は、実際の検索システムでもよく見られる。
一見すると誰でも使える簡潔なＵＩに思えますが、すべてのユーザーにとって
最適なインターフェースではないということは忘れてはいけない重要なポイントです。
具体的には、自分が探したいものを言語化して検索に使うキーワードとして入力できる
ユーザーにしか有効に使えません。」p.104

検索フォームの注意点
    プレースホルダーとして何らかの文字列を指定しておく
        「検索に慣れていないユーザーは、まっさらなテキストボックスを提示されても、
        何を入力してよいかわからない」p.105
    
検索結果が無い場合の表示
    「検索結果がありません」や「０件」といったメッセージを表示するだけでは
    ユーザーが得られる情報が少なすぎるかもしれません。
    （・・・）検索結果が無い場合に表示する情報としては、おすすめのドキュメントや
    全体から見たランキング、別の検索クエリの提案などが考えられます。p.111

検索をナビゲートする機能
    カテゴリによるナビゲーション
        検索対象のドキュメントを区分する分類
        カテゴリによるフィルタリング
        ファセット・・・検索結果のドキュメントについているメタデータを集計して視覚的に選択肢を提示する仕組み
            商品名と店名が同一である場合に、どちらかを選べる情報を提供すること

検索クエリの入力を補助する機能
    拡張入力フォーム（ANDとORボックスに入力、など）
    オートコンプリート
    クエリ提案
    検索履歴
        ユーザーが入力した検索クエリを保存しておき、次回以降の検索におけるサジェストに使う

